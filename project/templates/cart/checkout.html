{% extends 'nav.html' %}
{% load static %}
{% block content %}
<div class="container">
    <h2 class="text-center my-4">Checkout</h2>
    {% if messages %}
        {% for msg in messages %}
            <div class="alert alert-danger" role="alert">
                {{ msg }}
            </div>
        {% endfor %}
    {% endif %}
    <div class="row">
        <div class="col-md-6">
            <h4 class="text-center">Order Summary</h4>
            <hr>
            {% for item in cart_items %}
                <div class="card mb-2">
                    <div class="card-body d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h5><strong>{{ item.product.name }}</strong></h5>
                            <p>Quantity: {{ item.quantity }}</p>
                            <p class="fw-bold">
                                Price: Rs. 
                                {% if item.product.is_sale and item.product.sale_price %}
                                    {{ item.product.sale_price }}
                                {% else %}
                                    {{ item.product.price }}
                                {% endif %}
                            </p>
                        </div>
                        <div class="ms-3">
                            <img src="{{ item.product.image.url }}" alt="Product Image" class="img-thumbnail" style="width: 100px;">
                        </div>
                    </div>
                </div>
            {% endfor %}
            <p class="fw-bold text-center fs-5 mt-3">Total Cost + Rs.40 (Shipping) = Rs.{{ total_amount }}</p>
        </div>
        <div class="col-md-6">
            <h4 class="text-center">Shipping Address</h4>
            <hr>
            <form action="" method="POST">
                {% csrf_token %}
                {% for address in add %}
                    <div class="card mb-1">
                        <div class="card-body p-4">
                            <h5><strong>{{ address.first_name }} {{ address.last_name }}</strong></h5>
                            <p>Mobile: {{ address.phone }}</p>
                            <p>Location: {{ address.location }}</p>
                            <p>City: {{ address.city }}</p>
                            <p>Pincode: {{ address.pincode }}</p>
                        </div>
                    </div>
                    <div class="form-check p-4">
                        <input type="radio" class="form-check-input" name="custid" id="address{{ forloop.counter }}" value="{{ address.id }}">
                        <label class="form-check-label" for="address{{ forloop.counter }}">Use this address</label>
                    </div>
                {% endfor %}
                <h4 class="text-center">Payment Method</h4>
                    <hr>
                    <div class="form-check">
                        <input type="radio" class="form-check-input" name="payment_method" id="cod" value="cod" checked>
                        <label class="form-check-label" for="cod">Cash on Delivery</label>
                    </div>
                    <div class="form-check">
                        <input type="radio" class="form-check-input" name="payment_method" id="online" value="online">
                        <label class="form-check-label" for="online">Online Payment</label>
                    </div>
                    <div class="text-end mt-3">
                        <button type="submit" class="btn btn-primary">Proceed to Payment</button>
                    </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
